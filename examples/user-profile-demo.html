<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç”¨æˆ·èµ„æ–™è¡¨å• - @ldesign/form å®Œæ•´ç¤ºä¾‹</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --ldesign-brand-color: #722ED1;
      --ldesign-brand-color-hover: #5c24a8;
      --ldesign-error-color: #ff4d4f;
      --ldesign-success-color: #52c41a;
      --ldesign-text-color-primary: rgba(0, 0, 0, 0.85);
      --ldesign-bg-color: #fff;
      --ldesign-border-color: #d9d9d9;
      --ldesign-border-radius-base: 4px;
      --ldesign-spacing-base: 16px;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      padding: 20px;
      background: #f5f5f5;
      min-height: 100vh;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    .page-header {
      background: var(--ldesign-bg-color);
      padding: 24px;
      border-radius: var(--ldesign-border-radius-base);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      margin-bottom: 24px;
    }

    .page-header h1 {
      font-size: 24px;
      color: var(--ldesign-brand-color);
      margin-bottom: 8px;
    }

    .page-header p {
      font-size: 14px;
      color: rgba(0, 0, 0, 0.65);
    }

    .demo-tabs {
      display: flex;
      gap: 12px;
      background: var(--ldesign-bg-color);
      padding: 12px;
      border-radius: var(--ldesign-border-radius-base);
      margin-bottom: 24px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .tab-button {
      padding: 8px 16px;
      font-size: 14px;
      border: 1px solid var(--ldesign-border-color);
      border-radius: var(--ldesign-border-radius-base);
      background: var(--ldesign-bg-color);
      color: var(--ldesign-text-color-primary);
      cursor: pointer;
      transition: all 0.3s;
    }

    .tab-button:hover {
      border-color: var(--ldesign-brand-color);
      color: var(--ldesign-brand-color);
    }

    .tab-button.active {
      background: var(--ldesign-brand-color);
      border-color: var(--ldesign-brand-color);
      color: #fff;
    }

    .form-container {
      background: var(--ldesign-bg-color);
      padding: 32px;
      border-radius: var(--ldesign-border-radius-base);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .form-section {
      margin-bottom: 32px;
    }

    .form-section:last-child {
      margin-bottom: 0;
    }

    .form-section-title {
      font-size: 16px;
      font-weight: 600;
      color: var(--ldesign-text-color-primary);
      margin-bottom: 16px;
      padding-bottom: 8px;
      border-bottom: 1px solid #f0f0f0;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
    }

    .form-grid--full {
      grid-template-columns: 1fr;
    }

    .form-item {
      margin-bottom: 0;
    }

    .form-label {
      display: block;
      margin-bottom: 8px;
      font-size: 14px;
      color: var(--ldesign-text-color-primary);
      font-weight: 500;
    }

    .form-label .required {
      color: var(--ldesign-error-color);
      margin-right: 4px;
    }

    .form-control {
      position: relative;
    }

    .form-input,
    .form-select,
    .form-textarea {
      width: 100%;
      padding: 8px 12px;
      font-size: 14px;
      color: var(--ldesign-text-color-primary);
      background: var(--ldesign-bg-color);
      border: 1px solid var(--ldesign-border-color);
      border-radius: var(--ldesign-border-radius-base);
      outline: none;
      transition: all 0.3s;
    }

    .form-input:hover,
    .form-select:hover,
    .form-textarea:hover {
      border-color: var(--ldesign-brand-color);
    }

    .form-input:focus,
    .form-select:focus,
    .form-textarea:focus {
      border-color: var(--ldesign-brand-color);
      box-shadow: 0 0 0 2px rgba(114, 46, 209, 0.1);
    }

    .form-input.error,
    .form-select.error,
    .form-textarea.error {
      border-color: var(--ldesign-error-color);
    }

    .form-textarea {
      resize: vertical;
      min-height: 80px;
    }

    .error-message {
      display: block;
      margin-top: 4px;
      font-size: 12px;
      color: var(--ldesign-error-color);
    }

    .help-text {
      display: block;
      margin-top: 4px;
      font-size: 12px;
      color: rgba(0, 0, 0, 0.45);
    }

    .form-actions {
      display: flex;
      gap: 12px;
      padding-top: 24px;
      border-top: 1px solid #f0f0f0;
    }

    .btn {
      padding: 8px 16px;
      font-size: 14px;
      border: 1px solid var(--ldesign-border-color);
      border-radius: var(--ldesign-border-radius-base);
      background: var(--ldesign-bg-color);
      color: var(--ldesign-text-color-primary);
      cursor: pointer;
      transition: all 0.3s;
    }

    .btn:hover {
      border-color: var(--ldesign-brand-color);
      color: var(--ldesign-brand-color);
    }

    .btn-primary {
      background: var(--ldesign-brand-color);
      border-color: var(--ldesign-brand-color);
      color: #fff;
    }

    .btn-primary:hover {
      background: var(--ldesign-brand-color-hover);
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .avatar-upload {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .avatar-preview {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      overflow: hidden;
      border: 2px solid #f0f0f0;
    }

    .avatar-preview img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .avatar-placeholder {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #f5f5f5;
      color: rgba(0, 0, 0, 0.45);
      font-size: 32px;
    }

    .dynamic-list {
      border: 1px dashed #d9d9d9;
      border-radius: var(--ldesign-border-radius-base);
      padding: 16px;
    }

    .dynamic-item {
      display: grid;
      grid-template-columns: 1fr 1fr auto;
      gap: 12px;
      align-items: start;
      margin-bottom: 12px;
      padding: 12px;
      background: #fafafa;
      border-radius: var(--ldesign-border-radius-base);
    }

    .dynamic-item:last-child {
      margin-bottom: 0;
    }

    .btn-remove {
      padding: 4px 12px;
      color: var(--ldesign-error-color);
      border-color: var(--ldesign-error-color);
    }

    .btn-remove:hover {
      background: var(--ldesign-error-color);
      color: #fff;
    }

    .btn-add {
      width: 100%;
      margin-top: 12px;
      border-style: dashed;
    }

    .success-message {
      position: fixed;
      top: 24px;
      right: 24px;
      padding: 16px 24px;
      background: var(--ldesign-bg-color);
      border-left: 4px solid var(--ldesign-success-color);
      border-radius: var(--ldesign-border-radius-base);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      z-index: 1000;
      animation: slideIn 0.3s ease;
    }

    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }

      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    .validation-summary {
      padding: 16px;
      background: #fff7e6;
      border: 1px solid #ffd591;
      border-radius: var(--ldesign-border-radius-base);
      margin-bottom: 24px;
    }

    .validation-summary h3 {
      font-size: 14px;
      color: #fa8c16;
      margin-bottom: 8px;
    }

    .validation-summary ul {
      margin: 0;
      padding-left: 20px;
      font-size: 13px;
      color: rgba(0, 0, 0, 0.65);
    }
  </style>
</head>

<body>
  <div class="container">
    <!-- é¡µé¢å¤´éƒ¨ -->
    <div class="page-header">
      <h1>ğŸ‰ @ldesign/form å®Œæ•´åŠŸèƒ½æ¼”ç¤º</h1>
      <p>å±•ç¤ºè¡¨å•ç³»ç»Ÿçš„å®Œæ•´åŠŸèƒ½ï¼šå­—æ®µç±»å‹ã€éªŒè¯è§„åˆ™ã€åŠ¨æ€å­—æ®µã€æ¡ä»¶æ¸²æŸ“ã€å¤æ‚å¸ƒå±€ç­‰</p>
    </div>

    <!-- æ ‡ç­¾åˆ‡æ¢ -->
    <div class="demo-tabs">
      <button class="tab-button active" onclick="switchTab('profile')">ç”¨æˆ·èµ„æ–™</button>
      <button class="tab-button" onclick="switchTab('advanced')">é«˜çº§æŸ¥è¯¢</button>
      <button class="tab-button" onclick="switchTab('validation')">éªŒè¯è§„åˆ™</button>
    </div>

    <!-- è¡¨å•å®¹å™¨ -->
    <div id="app"></div>
  </div>

  <script type="module">
    import { createForm } from '../src/core/form-core.js'
    import * as validators from '../src/utils/validation-rules.js'

    let currentTab = 'profile'
    let currentForm = null

    // åˆ‡æ¢æ ‡ç­¾
    window.switchTab = (tab) => {
      currentTab = tab
      document.querySelectorAll('.tab-button').forEach(btn => {
        btn.classList.toggle('active', btn.textContent.includes(getTabName(tab)))
      })
      renderCurrentTab()
    }

    function getTabName(tab) {
      const names = {
        profile: 'ç”¨æˆ·èµ„æ–™',
        advanced: 'é«˜çº§æŸ¥è¯¢',
        validation: 'éªŒè¯è§„åˆ™'
      }
      return names[tab]
    }

    // æ¸²æŸ“å½“å‰æ ‡ç­¾
    function renderCurrentTab() {
      const app = document.getElementById('app')

      if (currentForm) {
        currentForm.destroy()
      }

      if (currentTab === 'profile') {
        renderProfileForm(app)
      } else if (currentTab === 'advanced') {
        renderAdvancedQueryForm(app)
      } else if (currentTab === 'validation') {
        renderValidationForm(app)
      }
    }

    // 1. ç”¨æˆ·èµ„æ–™è¡¨å•
    function renderProfileForm(container) {
      const form = createForm({
        initialValues: {
          avatar: '',
          username: '',
          email: '',
          phone: '',
          gender: '',
          birthday: '',
          bio: '',
          province: '',
          city: '',
          district: '',
          address: '',
          postalCode: '',
          company: '',
          position: '',
          website: '',
          socialAccounts: []
        },
        fields: [
          // åŸºæœ¬ä¿¡æ¯
          { name: 'avatar', label: 'å¤´åƒ' },
          {
            name: 'username', label: 'ç”¨æˆ·å', required: true, rules: [
              { validator: validators.required, message: 'è¯·è¾“å…¥ç”¨æˆ·å' },
              { validator: validators.minLength(3), message: 'ç”¨æˆ·åè‡³å°‘3ä¸ªå­—ç¬¦' },
              { validator: validators.maxLength(20), message: 'ç”¨æˆ·åæœ€å¤š20ä¸ªå­—ç¬¦' }
            ]
          },
          {
            name: 'email', label: 'é‚®ç®±', required: true, rules: [
              { validator: validators.required, message: 'è¯·è¾“å…¥é‚®ç®±' },
              { validator: validators.email, message: 'è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€' }
            ]
          },
          {
            name: 'phone', label: 'æ‰‹æœºå·', required: true, rules: [
              { validator: validators.required, message: 'è¯·è¾“å…¥æ‰‹æœºå·' },
              { validator: validators.phone, message: 'è¯·è¾“å…¥æœ‰æ•ˆçš„æ‰‹æœºå·ç ' }
            ]
          },
          { name: 'gender', label: 'æ€§åˆ«' },
          { name: 'birthday', label: 'ç”Ÿæ—¥' },
          { name: 'bio', label: 'ä¸ªäººç®€ä»‹' },

          // åœ°å€ä¿¡æ¯
          { name: 'province', label: 'çœä»½' },
          { name: 'city', label: 'åŸå¸‚' },
          { name: 'district', label: 'åŒºå¿' },
          { name: 'address', label: 'è¯¦ç»†åœ°å€' },
          {
            name: 'postalCode', label: 'é‚®æ”¿ç¼–ç ', rules: [
              { validator: validators.postalCode, message: 'è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®æ”¿ç¼–ç ' }
            ]
          },

          // å·¥ä½œä¿¡æ¯
          { name: 'company', label: 'å…¬å¸' },
          { name: 'position', label: 'èŒä½' },
          {
            name: 'website', label: 'ç½‘ç«™', rules: [
              { validator: validators.url, message: 'è¯·è¾“å…¥æœ‰æ•ˆçš„URLåœ°å€' }
            ]
          }
        ],
        onSubmit: async (values) => {
          console.log('æäº¤æ•°æ®:', values)
          showSuccessMessage('ä¿å­˜æˆåŠŸï¼')
        }
      })

      currentForm = form

      container.innerHTML = `
        <div class="form-container">
          <!-- åŸºæœ¬ä¿¡æ¯ -->
          <div class="form-section">
            <h2 class="form-section-title">ğŸ“ åŸºæœ¬ä¿¡æ¯</h2>
            
            <div class="form-item">
              <label class="form-label">å¤´åƒ</label>
              <div class="avatar-upload">
                <div class="avatar-preview">
                  <div class="avatar-placeholder" id="avatar-preview">ğŸ‘¤</div>
                </div>
                <input type="file" id="avatar" accept="image/*" style="display: none;" />
                <button type="button" class="btn" onclick="document.getElementById('avatar').click()">
                  ä¸Šä¼ å¤´åƒ
                </button>
              </div>
            </div>

            <div class="form-grid">
              <div class="form-item">
                <label class="form-label"><span class="required">*</span>ç”¨æˆ·å</label>
                <div class="form-control">
                  <input type="text" id="username" class="form-input" placeholder="è¯·è¾“å…¥ç”¨æˆ·å" />
                  <span id="username-error" class="error-message"></span>
                  <span class="help-text">3-20ä¸ªå­—ç¬¦</span>
                </div>
              </div>

              <div class="form-item">
                <label class="form-label"><span class="required">*</span>é‚®ç®±</label>
                <div class="form-control">
                  <input type="email" id="email" class="form-input" placeholder="è¯·è¾“å…¥é‚®ç®±" />
                  <span id="email-error" class="error-message"></span>
                </div>
              </div>

              <div class="form-item">
                <label class="form-label"><span class="required">*</span>æ‰‹æœºå·</label>
                <div class="form-control">
                  <input type="tel" id="phone" class="form-input" placeholder="è¯·è¾“å…¥æ‰‹æœºå·" />
                  <span id="phone-error" class="error-message"></span>
                </div>
              </div>

              <div class="form-item">
                <label class="form-label">æ€§åˆ«</label>
                <div class="form-control">
                  <select id="gender" class="form-select">
                    <option value="">è¯·é€‰æ‹©</option>
                    <option value="male">ç”·</option>
                    <option value="female">å¥³</option>
                    <option value="other">å…¶ä»–</option>
                  </select>
                </div>
              </div>

              <div class="form-item">
                <label class="form-label">ç”Ÿæ—¥</label>
                <div class="form-control">
                  <input type="date" id="birthday" class="form-input" />
                </div>
              </div>
            </div>

            <div class="form-grid form-grid--full">
              <div class="form-item">
                <label class="form-label">ä¸ªäººç®€ä»‹</label>
                <div class="form-control">
                  <textarea id="bio" class="form-textarea" placeholder="ä»‹ç»ä¸€ä¸‹è‡ªå·±..." rows="4"></textarea>
                  <span class="help-text" id="bio-count">0 / 500</span>
                </div>
              </div>
            </div>
          </div>

          <!-- åœ°å€ä¿¡æ¯ -->
          <div class="form-section">
            <h2 class="form-section-title">ğŸ“ åœ°å€ä¿¡æ¯</h2>
            
            <div class="form-grid">
              <div class="form-item">
                <label class="form-label">çœä»½</label>
                <div class="form-control">
                  <select id="province" class="form-select">
                    <option value="">è¯·é€‰æ‹©çœä»½</option>
                    <option value="beijing">åŒ—äº¬å¸‚</option>
                    <option value="shanghai">ä¸Šæµ·å¸‚</option>
                    <option value="guangdong">å¹¿ä¸œçœ</option>
                    <option value="zhejiang">æµ™æ±Ÿçœ</option>
                  </select>
                </div>
              </div>

              <div class="form-item">
                <label class="form-label">åŸå¸‚</label>
                <div class="form-control">
                  <select id="city" class="form-select">
                    <option value="">è¯·é€‰æ‹©åŸå¸‚</option>
                  </select>
                </div>
              </div>

              <div class="form-item">
                <label class="form-label">åŒºå¿</label>
                <div class="form-control">
                  <select id="district" class="form-select">
                    <option value="">è¯·é€‰æ‹©åŒºå¿</option>
                  </select>
                </div>
              </div>

              <div class="form-item">
                <label class="form-label">é‚®æ”¿ç¼–ç </label>
                <div class="form-control">
                  <input type="text" id="postalCode" class="form-input" placeholder="6ä½é‚®æ”¿ç¼–ç " maxlength="6" />
                  <span id="postalCode-error" class="error-message"></span>
                </div>
              </div>
            </div>

            <div class="form-grid form-grid--full">
              <div class="form-item">
                <label class="form-label">è¯¦ç»†åœ°å€</label>
                <div class="form-control">
                  <input type="text" id="address" class="form-input" placeholder="è¡—é“ã€é—¨ç‰Œå·ç­‰" />
                </div>
              </div>
            </div>
          </div>

          <!-- å·¥ä½œä¿¡æ¯ -->
          <div class="form-section">
            <h2 class="form-section-title">ğŸ’¼ å·¥ä½œä¿¡æ¯</h2>
            
            <div class="form-grid">
              <div class="form-item">
                <label class="form-label">å…¬å¸</label>
                <div class="form-control">
                  <input type="text" id="company" class="form-input" placeholder="å…¬å¸åç§°" />
                </div>
              </div>

              <div class="form-item">
                <label class="form-label">èŒä½</label>
                <div class="form-control">
                  <input type="text" id="position" class="form-input" placeholder="èŒä½åç§°" />
                </div>
              </div>

              <div class="form-item">
                <label class="form-label">ä¸ªäººç½‘ç«™</label>
                <div class="form-control">
                  <input type="url" id="website" class="form-input" placeholder="https://example.com" />
                  <span id="website-error" class="error-message"></span>
                </div>
              </div>
            </div>
          </div>

          <!-- ç¤¾äº¤è´¦å·ï¼ˆåŠ¨æ€æ•°ç»„ï¼‰ -->
          <div class="form-section">
            <h2 class="form-section-title">ğŸ”— ç¤¾äº¤è´¦å·</h2>
            
            <div class="dynamic-list" id="socialAccounts">
              <p style="text-align: center; color: rgba(0, 0, 0, 0.45);">æš‚æ— ç¤¾äº¤è´¦å·</p>
            </div>
            <button type="button" class="btn btn-add" onclick="addSocialAccount()">
              + æ·»åŠ ç¤¾äº¤è´¦å·
            </button>
          </div>

          <!-- éªŒè¯æ‘˜è¦ -->
          <div id="validation-summary" style="display: none;"></div>

          <!-- æ“ä½œæŒ‰é’® -->
          <div class="form-actions">
            <button type="button" id="submit-btn" class="btn btn-primary">ä¿å­˜</button>
            <button type="button" id="reset-btn" class="btn">é‡ç½®</button>
            <button type="button" id="validate-btn" class="btn">éªŒè¯</button>
          </div>
        </div>
      `

      bindFormEvents(form)
    }

    // 2. é«˜çº§æŸ¥è¯¢è¡¨å•
    function renderAdvancedQueryForm(container) {
      const form = createForm({
        initialValues: {
          keyword: '',
          category: '',
          status: '',
          author: '',
          startDate: '',
          endDate: '',
          minPrice: '',
          maxPrice: '',
          tags: []
        },
        expand: {
          previewRows: 2,
          defaultExpanded: false
        },
        onSubmit: (values) => {
          console.log('æŸ¥è¯¢æ¡ä»¶:', values)
          showSuccessMessage('æŸ¥è¯¢æˆåŠŸï¼')
        }
      })

      currentForm = form

      container.innerHTML = `
        <div class="form-container">
          <h2 class="form-section-title">ğŸ” é«˜çº§æŸ¥è¯¢è¡¨å•</h2>
          
          <div class="form-grid">
            <div class="form-item">
              <label class="form-label">å…³é”®è¯</label>
              <input type="text" id="keyword" class="form-input" placeholder="è¯·è¾“å…¥å…³é”®è¯" />
            </div>

            <div class="form-item">
              <label class="form-label">åˆ†ç±»</label>
              <select id="category" class="form-select">
                <option value="">å…¨éƒ¨</option>
                <option value="tech">æŠ€æœ¯</option>
                <option value="product">äº§å“</option>
                <option value="design">è®¾è®¡</option>
              </select>
            </div>

            <div class="form-item">
              <label class="form-label">çŠ¶æ€</label>
              <select id="status" class="form-select">
                <option value="">å…¨éƒ¨</option>
                <option value="active">å¯ç”¨</option>
                <option value="inactive">ç¦ç”¨</option>
              </select>
            </div>

            <div class="form-item">
              <label class="form-label">ä½œè€…</label>
              <input type="text" id="author" class="form-input" placeholder="è¯·è¾“å…¥ä½œè€…" />
            </div>

            <div class="form-item">
              <label class="form-label">å¼€å§‹æ—¥æœŸ</label>
              <input type="date" id="startDate" class="form-input" />
            </div>

            <div class="form-item">
              <label class="form-label">ç»“æŸæ—¥æœŸ</label>
              <input type="date" id="endDate" class="form-input" />
            </div>

            <div class="form-item">
              <label class="form-label">æœ€ä½ä»·æ ¼</label>
              <input type="number" id="minPrice" class="form-input" placeholder="0" />
            </div>

            <div class="form-item">
              <label class="form-label">æœ€é«˜ä»·æ ¼</label>
              <input type="number" id="maxPrice" class="form-input" placeholder="999999" />
            </div>
          </div>

          <div class="form-actions">
            <button type="button" id="submit-btn" class="btn btn-primary">æŸ¥è¯¢</button>
            <button type="button" id="reset-btn" class="btn">é‡ç½®</button>
            <button type="button" id="expand-btn" class="btn">å±•å¼€æ›´å¤š</button>
          </div>

          <div id="query-result" style="display: none; margin-top: 24px; padding: 16px; background: #f0f0f0; border-radius: 4px;">
            <h3 style="margin-bottom: 12px;">æŸ¥è¯¢ç»“æœ</h3>
            <pre id="result-content" style="margin: 0; font-size: 13px;"></pre>
          </div>
        </div>
      `

      bindFormEvents(form, true)
    }

    // 3. éªŒè¯è§„åˆ™å±•ç¤º
    function renderValidationForm(container) {
      const form = createForm({
        initialValues: {
          requiredField: '',
          emailField: '',
          phoneField: '',
          urlField: '',
          numberField: '',
          minField: '',
          maxField: '',
          minLengthField: '',
          maxLengthField: '',
          patternField: '',
          password: '',
          confirmPassword: '',
          idCardField: '',
          creditCardField: '',
          ipField: '',
          postalCodeField: ''
        },
        fields: [
          {
            name: 'requiredField', label: 'å¿…å¡«å­—æ®µ', required: true, rules: [
              { validator: validators.required, message: 'æ­¤å­—æ®µä¸ºå¿…å¡«é¡¹' }
            ]
          },
          {
            name: 'emailField', label: 'é‚®ç®±éªŒè¯', rules: [
              { validator: validators.email, message: 'è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€' }
            ]
          },
          {
            name: 'phoneField', label: 'æ‰‹æœºå·éªŒè¯', rules: [
              { validator: validators.phone, message: 'è¯·è¾“å…¥æœ‰æ•ˆçš„æ‰‹æœºå·ç ' }
            ]
          },
          {
            name: 'urlField', label: 'URLéªŒè¯', rules: [
              { validator: validators.url, message: 'è¯·è¾“å…¥æœ‰æ•ˆçš„URLåœ°å€' }
            ]
          },
          {
            name: 'numberField', label: 'æ•°å­—éªŒè¯', rules: [
              { validator: validators.number, message: 'è¯·è¾“å…¥æœ‰æ•ˆçš„æ•°å­—' }
            ]
          },
          {
            name: 'minField', label: 'æœ€å°å€¼éªŒè¯ (â‰¥10)', rules: [
              { validator: validators.min(10), message: 'å€¼ä¸èƒ½å°äº10' }
            ]
          },
          {
            name: 'maxField', label: 'æœ€å¤§å€¼éªŒè¯ (â‰¤100)', rules: [
              { validator: validators.max(100), message: 'å€¼ä¸èƒ½å¤§äº100' }
            ]
          },
          {
            name: 'minLengthField', label: 'æœ€å°é•¿åº¦éªŒè¯ (â‰¥5)', rules: [
              { validator: validators.minLength(5), message: 'é•¿åº¦ä¸èƒ½å°‘äº5ä¸ªå­—ç¬¦' }
            ]
          },
          {
            name: 'maxLengthField', label: 'æœ€å¤§é•¿åº¦éªŒè¯ (â‰¤10)', rules: [
              { validator: validators.maxLength(10), message: 'é•¿åº¦ä¸èƒ½è¶…è¿‡10ä¸ªå­—ç¬¦' }
            ]
          },
          {
            name: 'patternField', label: 'æ­£åˆ™éªŒè¯ (åªèƒ½è¾“å…¥å­—æ¯å’Œæ•°å­—)', rules: [
              { validator: validators.pattern(/^[a-zA-Z0-9]+$/), message: 'åªèƒ½è¾“å…¥å­—æ¯å’Œæ•°å­—' }
            ]
          },
          {
            name: 'password', label: 'å¯†ç  (å¼ºåº¦éªŒè¯)', rules: [
              { validator: validators.passwordStrength('medium'), message: 'å¯†ç è‡³å°‘8ä¸ªå­—ç¬¦ï¼Œä¸”åŒ…å«æ•°å­—å’Œå­—æ¯' }
            ]
          },
          {
            name: 'confirmPassword', label: 'ç¡®è®¤å¯†ç ', rules: [
              { validator: validators.confirm('password'), message: 'ä¸¤æ¬¡å¯†ç è¾“å…¥ä¸ä¸€è‡´' }
            ]
          },
          {
            name: 'idCardField', label: 'èº«ä»½è¯å·éªŒè¯', rules: [
              { validator: validators.idCard, message: 'è¯·è¾“å…¥æœ‰æ•ˆçš„èº«ä»½è¯å·ç ' }
            ]
          },
          {
            name: 'creditCardField', label: 'ä¿¡ç”¨å¡å·éªŒè¯', rules: [
              { validator: validators.creditCard, message: 'è¯·è¾“å…¥æœ‰æ•ˆçš„ä¿¡ç”¨å¡å·ç ' }
            ]
          },
          {
            name: 'ipField', label: 'IPåœ°å€éªŒè¯', rules: [
              { validator: validators.ip, message: 'è¯·è¾“å…¥æœ‰æ•ˆçš„IPåœ°å€' }
            ]
          },
          {
            name: 'postalCodeField', label: 'é‚®æ”¿ç¼–ç éªŒè¯', rules: [
              { validator: validators.postalCode, message: 'è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®æ”¿ç¼–ç ' }
            ]
          }
        ],
        onSubmit: (values) => {
          console.log('éªŒè¯é€šè¿‡ï¼Œæäº¤æ•°æ®:', values)
          showSuccessMessage('æ‰€æœ‰éªŒè¯è§„åˆ™é€šè¿‡ï¼')
        }
      })

      currentForm = form

      const fieldNames = [
        'requiredField', 'emailField', 'phoneField', 'urlField', 'numberField',
        'minField', 'maxField', 'minLengthField', 'maxLengthField', 'patternField',
        'password', 'confirmPassword', 'idCardField', 'creditCardField', 'ipField', 'postalCodeField'
      ]

      const fieldLabels = {
        requiredField: 'å¿…å¡«å­—æ®µ',
        emailField: 'é‚®ç®±éªŒè¯',
        phoneField: 'æ‰‹æœºå·éªŒè¯',
        urlField: 'URLéªŒè¯',
        numberField: 'æ•°å­—éªŒè¯',
        minField: 'æœ€å°å€¼éªŒè¯ (â‰¥10)',
        maxField: 'æœ€å¤§å€¼éªŒè¯ (â‰¤100)',
        minLengthField: 'æœ€å°é•¿åº¦éªŒè¯ (â‰¥5)',
        maxLengthField: 'æœ€å¤§é•¿åº¦éªŒè¯ (â‰¤10)',
        patternField: 'æ­£åˆ™éªŒè¯ (åªèƒ½è¾“å…¥å­—æ¯å’Œæ•°å­—)',
        password: 'å¯†ç  (å¼ºåº¦éªŒè¯)',
        confirmPassword: 'ç¡®è®¤å¯†ç ',
        idCardField: 'èº«ä»½è¯å·éªŒè¯',
        creditCardField: 'ä¿¡ç”¨å¡å·éªŒè¯',
        ipField: 'IPåœ°å€éªŒè¯',
        postalCodeField: 'é‚®æ”¿ç¼–ç éªŒè¯'
      }

      const placeholders = {
        requiredField: 'æ­¤å­—æ®µå¿…é¡»å¡«å†™',
        emailField: 'ä¾‹å¦‚ï¼šuser@example.com',
        phoneField: 'ä¾‹å¦‚ï¼š13800138000',
        urlField: 'ä¾‹å¦‚ï¼šhttps://example.com',
        numberField: 'è¯·è¾“å…¥æ•°å­—',
        minField: 'è¯·è¾“å…¥â‰¥10çš„æ•°å­—',
        maxField: 'è¯·è¾“å…¥â‰¤100çš„æ•°å­—',
        minLengthField: 'è‡³å°‘5ä¸ªå­—ç¬¦',
        maxLengthField: 'æœ€å¤š10ä¸ªå­—ç¬¦',
        patternField: 'åªèƒ½è¾“å…¥å­—æ¯å’Œæ•°å­—',
        password: 'è‡³å°‘8ä¸ªå­—ç¬¦ï¼ŒåŒ…å«æ•°å­—å’Œå­—æ¯',
        confirmPassword: 'å†æ¬¡è¾“å…¥å¯†ç ',
        idCardField: 'ä¾‹å¦‚ï¼š110101199001011234',
        creditCardField: 'ä¾‹å¦‚ï¼š4532015112830366',
        ipField: 'ä¾‹å¦‚ï¼š192.168.1.1',
        postalCodeField: 'ä¾‹å¦‚ï¼š100000'
      }

      let html = '<div class="form-container">'
      html += '<h2 class="form-section-title">âœ… éªŒè¯è§„åˆ™å±•ç¤º</h2>'
      html += '<div class="form-grid">'

      fieldNames.forEach(name => {
        const isRequired = name === 'requiredField'
        html += `
          <div class="form-item">
            <label class="form-label">
              ${isRequired ? '<span class="required">*</span>' : ''}
              ${fieldLabels[name]}
            </label>
            <div class="form-control">
              <input 
                type="${name.includes('password') ? 'password' : 'text'}"
                id="${name}"
                class="form-input"
                placeholder="${placeholders[name]}"
              />
              <span id="${name}-error" class="error-message"></span>
            </div>
          </div>
        `
      })

      html += '</div>'
      html += '<div id="validation-summary" style="display: none;"></div>'
      html += `
        <div class="form-actions">
          <button type="button" id="submit-btn" class="btn btn-primary">æäº¤</button>
          <button type="button" id="reset-btn" class="btn">é‡ç½®</button>
          <button type="button" id="validate-btn" class="btn">å…¨éƒ¨éªŒè¯</button>
        </div>
      </div>`

      container.innerHTML = html
      bindFormEvents(form)
    }

    // ç»‘å®šè¡¨å•äº‹ä»¶
    function bindFormEvents(form, hasExpand = false) {
      const fieldNames = form.getFieldManager().getAllFieldNames()

      fieldNames.forEach(field => {
        const input = document.getElementById(field)
        const errorEl = document.getElementById(`${field}-error`)

        if (!input) return

        input.addEventListener('input', (e) => {
          form.setFieldValue(field, e.target.value)

          // å­—ç¬¦è®¡æ•°
          if (field === 'bio') {
            const count = document.getElementById('bio-count')
            if (count) {
              count.textContent = `${e.target.value.length} / 500`
            }
          }
        })

        input.addEventListener('blur', async () => {
          await form.validateField(field)
          const state = form.getFieldState(field)

          if (state && state.errors.length > 0) {
            if (errorEl) {
              errorEl.textContent = state.errors[0]
              errorEl.style.display = 'block'
            }
            input.classList.add('error')
          } else {
            if (errorEl) {
              errorEl.style.display = 'none'
            }
            input.classList.remove('error')
          }
        })
      })

      // æäº¤æŒ‰é’®
      const submitBtn = document.getElementById('submit-btn')
      if (submitBtn) {
        submitBtn.addEventListener('click', async () => {
          submitBtn.disabled = true
          submitBtn.textContent = 'æäº¤ä¸­...'

          try {
            await form.submit()

            // æ˜¾ç¤ºæŸ¥è¯¢ç»“æœ
            if (hasExpand) {
              const resultDiv = document.getElementById('query-result')
              const resultContent = document.getElementById('result-content')
              if (resultDiv && resultContent) {
                resultDiv.style.display = 'block'
                resultContent.textContent = JSON.stringify(form.getFieldsValue(), null, 2)
              }
            }
          } catch (error) {
            console.error('æäº¤å¤±è´¥:', error)
            showValidationSummary(form)
          } finally {
            submitBtn.disabled = false
            submitBtn.textContent = hasExpand ? 'æŸ¥è¯¢' : 'ä¿å­˜'
          }
        })
      }

      // é‡ç½®æŒ‰é’®
      const resetBtn = document.getElementById('reset-btn')
      if (resetBtn) {
        resetBtn.addEventListener('click', () => {
          form.reset()
          fieldNames.forEach(field => {
            const input = document.getElementById(field)
            const errorEl = document.getElementById(`${field}-error`)
            if (input) {
              input.value = ''
              input.classList.remove('error')
            }
            if (errorEl) {
              errorEl.style.display = 'none'
            }
          })
          hideValidationSummary()
        })
      }

      // éªŒè¯æŒ‰é’®
      const validateBtn = document.getElementById('validate-btn')
      if (validateBtn) {
        validateBtn.addEventListener('click', async () => {
          const result = await form.validate()
          if (result.valid) {
            showSuccessMessage('éªŒè¯é€šè¿‡ï¼')
            hideValidationSummary()
          } else {
            showValidationSummary(form)
          }
        })
      }

      // å±•å¼€æŒ‰é’®
      if (hasExpand) {
        const expandBtn = document.getElementById('expand-btn')
        if (expandBtn) {
          expandBtn.addEventListener('click', () => {
            form.toggleExpand()
            expandBtn.textContent = form.isExpanded() ? 'æ”¶èµ·' : 'å±•å¼€æ›´å¤š'
          })
        }
      }
    }

    // æ·»åŠ ç¤¾äº¤è´¦å·
    window.addSocialAccount = () => {
      const container = document.getElementById('socialAccounts')
      const index = container.querySelectorAll('.dynamic-item').length

      if (index === 0) {
        container.innerHTML = ''
      }

      const item = document.createElement('div')
      item.className = 'dynamic-item'
      item.innerHTML = `
        <div class="form-item">
          <label class="form-label">å¹³å°</label>
          <select class="form-select social-platform-${index}">
            <option value="">è¯·é€‰æ‹©</option>
            <option value="github">GitHub</option>
            <option value="twitter">Twitter</option>
            <option value="linkedin">LinkedIn</option>
            <option value="weibo">å¾®åš</option>
          </select>
        </div>
        <div class="form-item">
          <label class="form-label">è´¦å·</label>
          <input type="text" class="form-input social-account-${index}" placeholder="è¯·è¾“å…¥è´¦å·" />
        </div>
        <div>
          <button type="button" class="btn btn-remove" onclick="removeSocialAccount(this)">
            åˆ é™¤
          </button>
        </div>
      `

      container.appendChild(item)
    }

    window.removeSocialAccount = (btn) => {
      btn.closest('.dynamic-item').remove()

      const container = document.getElementById('socialAccounts')
      if (container.querySelectorAll('.dynamic-item').length === 0) {
        container.innerHTML = '<p style="text-align: center; color: rgba(0, 0, 0, 0.45);">æš‚æ— ç¤¾äº¤è´¦å·</p>'
      }
    }

    // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
    function showSuccessMessage(message) {
      const msgDiv = document.createElement('div')
      msgDiv.className = 'success-message'
      msgDiv.textContent = message
      document.body.appendChild(msgDiv)

      setTimeout(() => {
        msgDiv.remove()
      }, 3000)
    }

    // æ˜¾ç¤ºéªŒè¯æ‘˜è¦
    function showValidationSummary(form) {
      const summary = document.getElementById('validation-summary')
      if (!summary) return

      const state = form.getFormState()
      const errors = []

      form.getFieldManager().getAllFieldNames().forEach(field => {
        const fieldState = form.getFieldState(field)
        if (fieldState && fieldState.errors.length > 0) {
          errors.push(`${field}: ${fieldState.errors[0]}`)
        }
      })

      if (errors.length > 0) {
        summary.innerHTML = `
          <div class="validation-summary">
            <h3>âŒ è¡¨å•éªŒè¯å¤±è´¥ (${errors.length}ä¸ªé”™è¯¯)</h3>
            <ul>
              ${errors.map(err => `<li>${err}</li>`).join('')}
            </ul>
          </div>
        `
        summary.style.display = 'block'
      }
    }

    function hideValidationSummary() {
      const summary = document.getElementById('validation-summary')
      if (summary) {
        summary.style.display = 'none'
      }
    }

    // åˆå§‹åŒ–
    renderCurrentTab()
  </script>
</body>

</html>



