<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>动态数组字段演示 - @ldesign/form</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --ldesign-brand-color: #722ED1;
      --ldesign-error-color: #ff4d4f;
      --ldesign-success-color: #52c41a;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      padding: 20px;
      background: #f5f5f5;
    }

    .container {
      max-width: 1000px;
      margin: 0 auto;
    }

    .page-header {
      background: #fff;
      padding: 24px;
      border-radius: 4px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      margin-bottom: 24px;
    }

    .page-header h1 {
      font-size: 24px;
      color: var(--ldesign-brand-color);
      margin-bottom: 8px;
    }

    .section-card {
      background: #fff;
      padding: 24px;
      border-radius: 4px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      margin-bottom: 24px;
    }

    .section-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 20px;
      color: rgba(0, 0, 0, 0.85);
    }

    .array-list {
      border: 1px dashed #d9d9d9;
      border-radius: 4px;
      padding: 16px;
      min-height: 100px;
    }

    .array-item {
      position: relative;
      margin-bottom: 16px;
      padding: 16px;
      background: #fafafa;
      border: 1px solid #e0e0e0;
      border-radius: 4px;
      transition: all 0.3s;
    }

    .array-item:hover {
      border-color: var(--ldesign-brand-color);
      box-shadow: 0 2px 8px rgba(114, 46, 209, 0.1);
    }

    .array-item-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
      padding-bottom: 8px;
      border-bottom: 1px solid #e0e0e0;
    }

    .array-item-title {
      font-size: 14px;
      font-weight: 600;
      color: rgba(0, 0, 0, 0.85);
    }

    .array-item-actions {
      display: flex;
      gap: 8px;
    }

    .array-item-fields {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 12px;
    }

    .form-item {
      margin-bottom: 0;
    }

    .form-label {
      display: block;
      margin-bottom: 6px;
      font-size: 13px;
      font-weight: 500;
      color: rgba(0, 0, 0, 0.65);
    }

    .form-label .required {
      color: var(--ldesign-error-color);
      margin-right: 4px;
    }

    .form-input,
    .form-select,
    .form-textarea {
      width: 100%;
      padding: 6px 11px;
      font-size: 14px;
      border: 1px solid #d9d9d9;
      border-radius: 4px;
      outline: none;
      transition: all 0.3s;
    }

    .form-input:focus,
    .form-select:focus,
    .form-textarea:focus {
      border-color: var(--ldesign-brand-color);
      box-shadow: 0 0 0 2px rgba(114, 46, 209, 0.1);
    }

    .form-input.error {
      border-color: var(--ldesign-error-color);
    }

    .error-message {
      display: block;
      margin-top: 4px;
      font-size: 12px;
      color: var(--ldesign-error-color);
    }

    .btn {
      padding: 6px 12px;
      font-size: 13px;
      border: 1px solid #d9d9d9;
      border-radius: 4px;
      background: #fff;
      cursor: pointer;
      transition: all 0.3s;
    }

    .btn:hover {
      border-color: var(--ldesign-brand-color);
      color: var(--ldesign-brand-color);
    }

    .btn-icon {
      padding: 4px 8px;
      font-size: 16px;
    }

    .btn-remove {
      color: var(--ldesign-error-color);
      border-color: var(--ldesign-error-color);
    }

    .btn-remove:hover {
      background: var(--ldesign-error-color);
      color: #fff;
    }

    .btn-add {
      width: 100%;
      margin-top: 12px;
      border-style: dashed;
      padding: 10px;
    }

    .btn-add:hover {
      background: rgba(114, 46, 209, 0.05);
    }

    .btn-primary {
      background: var(--ldesign-brand-color);
      border-color: var(--ldesign-brand-color);
      color: #fff;
    }

    .btn-primary:hover {
      background: #5c24a8;
    }

    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: rgba(0, 0, 0, 0.45);
    }

    .form-actions {
      display: flex;
      gap: 12px;
      padding-top: 24px;
      border-top: 1px solid #f0f0f0;
    }

    .success-message {
      position: fixed;
      top: 24px;
      right: 24px;
      padding: 16px 24px;
      background: #fff;
      border-left: 4px solid var(--ldesign-success-color);
      border-radius: 4px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      z-index: 1000;
      animation: slideIn 0.3s ease;
    }

    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }

      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <!-- 页面头部 -->
    <div class="page-header">
      <h1>🔄 动态数组字段演示</h1>
      <p>展示如何使用动态数组字段：添加/删除/排序，适用于联系人、工作经历、教育背景等场景</p>
    </div>

    <!-- 1. 联系人列表 -->
    <div class="section-card">
      <h2 class="section-title">👥 联系人列表</h2>

      <div class="array-list" id="contactList">
        <div class="empty-state">暂无联系人</div>
      </div>

      <button type="button" class="btn btn-add" onclick="addContact()">
        + 添加联系人
      </button>
    </div>

    <!-- 2. 工作经历 -->
    <div class="section-card">
      <h2 class="section-title">💼 工作经历</h2>

      <div class="array-list" id="experienceList">
        <div class="empty-state">暂无工作经历</div>
      </div>

      <button type="button" class="btn btn-add" onclick="addExperience()">
        + 添加工作经历
      </button>
    </div>

    <!-- 3. 教育背景 -->
    <div class="section-card">
      <h2 class="section-title">🎓 教育背景</h2>

      <div class="array-list" id="educationList">
        <div class="empty-state">暂无教育背景</div>
      </div>

      <button type="button" class="btn btn-add" onclick="addEducation()">
        + 添加教育背景
      </button>
    </div>

    <!-- 提交区域 -->
    <div class="section-card">
      <div class="form-actions">
        <button type="button" id="submitBtn" class="btn btn-primary">提交</button>
        <button type="button" id="resetBtn" class="btn">重置所有</button>
      </div>
    </div>
  </div>

  <script type="module">
    import { createForm } from '../src/core/form-core.js'
    import * as validators from '../src/utils/validation-rules.js'

    // 数据存储
    const formData = {
      contacts: [],
      experiences: [],
      educations: []
    }

    // 创建表单实例
    const form = createForm({
      initialValues: formData,
      onSubmit: async (values) => {
        console.log('提交数据:', formData)
        showSuccessMessage('数据已成功保存！')
      }
    })

    // 1. 联系人管理
    window.addContact = () => {
      const list = document.getElementById('contactList')
      const index = formData.contacts.length

      if (index === 0) {
        list.innerHTML = ''
      }

      formData.contacts.push({
        name: '',
        phone: '',
        email: '',
        relationship: ''
      })

      const item = document.createElement('div')
      item.className = 'array-item'
      item.dataset.index = index
      item.innerHTML = `
        <div class="array-item-header">
          <span class="array-item-title">联系人 #${index + 1}</span>
          <div class="array-item-actions">
            <button type="button" class="btn btn-icon" onclick="moveContact(${index}, -1)" ${index === 0 ? 'disabled' : ''}>
              ↑
            </button>
            <button type="button" class="btn btn-icon" onclick="moveContact(${index}, 1)">
              ↓
            </button>
            <button type="button" class="btn btn-remove" onclick="removeContact(${index})">
              删除
            </button>
          </div>
        </div>
        <div class="array-item-fields">
          <div class="form-item">
            <label class="form-label"><span class="required">*</span>姓名</label>
            <input type="text" class="form-input contact-name-${index}" placeholder="请输入姓名" />
            <span class="error-message" id="contact-name-${index}-error"></span>
          </div>
          <div class="form-item">
            <label class="form-label"><span class="required">*</span>电话</label>
            <input type="tel" class="form-input contact-phone-${index}" placeholder="请输入电话" />
            <span class="error-message" id="contact-phone-${index}-error"></span>
          </div>
          <div class="form-item">
            <label class="form-label">邮箱</label>
            <input type="email" class="form-input contact-email-${index}" placeholder="请输入邮箱" />
          </div>
          <div class="form-item">
            <label class="form-label">关系</label>
            <select class="form-select contact-relationship-${index}">
              <option value="">请选择</option>
              <option value="family">家人</option>
              <option value="friend">朋友</option>
              <option value="colleague">同事</option>
            </select>
          </div>
        </div>
      `

      list.appendChild(item)
      updateContactButtons()
    }

    window.removeContact = (index) => {
      formData.contacts.splice(index, 1)
      renderContactList()
    }

    window.moveContact = (index, direction) => {
      const newIndex = index + direction
      if (newIndex < 0 || newIndex >= formData.contacts.length) return

      // 收集当前数据
      collectContactData()

      // 交换位置
      const temp = formData.contacts[index]
      formData.contacts[index] = formData.contacts[newIndex]
      formData.contacts[newIndex] = temp

      // 重新渲染
      renderContactList()
    }

    function collectContactData() {
      formData.contacts.forEach((contact, i) => {
        contact.name = document.querySelector(`.contact-name-${i}`)?.value || ''
        contact.phone = document.querySelector(`.contact-phone-${i}`)?.value || ''
        contact.email = document.querySelector(`.contact-email-${i}`)?.value || ''
        contact.relationship = document.querySelector(`.contact-relationship-${i}`)?.value || ''
      })
    }

    function renderContactList() {
      const list = document.getElementById('contactList')

      if (formData.contacts.length === 0) {
        list.innerHTML = '<div class="empty-state">暂无联系人</div>'
        return
      }

      list.innerHTML = ''
      formData.contacts.forEach((contact, index) => {
        const item = document.createElement('div')
        item.className = 'array-item'
        item.dataset.index = index
        item.innerHTML = `
          <div class="array-item-header">
            <span class="array-item-title">联系人 #${index + 1}</span>
            <div class="array-item-actions">
              <button type="button" class="btn btn-icon" onclick="moveContact(${index}, -1)" ${index === 0 ? 'disabled' : ''}>
                ↑
              </button>
              <button type="button" class="btn btn-icon" onclick="moveContact(${index}, 1)" ${index === formData.contacts.length - 1 ? 'disabled' : ''}>
                ↓
              </button>
              <button type="button" class="btn btn-remove" onclick="removeContact(${index})">
                删除
              </button>
            </div>
          </div>
          <div class="array-item-fields">
            <div class="form-item">
              <label class="form-label"><span class="required">*</span>姓名</label>
              <input type="text" class="form-input contact-name-${index}" value="${contact.name}" placeholder="请输入姓名" />
            </div>
            <div class="form-item">
              <label class="form-label"><span class="required">*</span>电话</label>
              <input type="tel" class="form-input contact-phone-${index}" value="${contact.phone}" placeholder="请输入电话" />
            </div>
            <div class="form-item">
              <label class="form-label">邮箱</label>
              <input type="email" class="form-input contact-email-${index}" value="${contact.email}" placeholder="请输入邮箱" />
            </div>
            <div class="form-item">
              <label class="form-label">关系</label>
              <select class="form-select contact-relationship-${index}">
                <option value="">请选择</option>
                <option value="family" ${contact.relationship === 'family' ? 'selected' : ''}>家人</option>
                <option value="friend" ${contact.relationship === 'friend' ? 'selected' : ''}>朋友</option>
                <option value="colleague" ${contact.relationship === 'colleague' ? 'selected' : ''}>同事</option>
              </select>
            </div>
          </div>
        `
        list.appendChild(item)
      })
    }

    function updateContactButtons() {
      // 更新上下移动按钮状态
      document.querySelectorAll('#contactList .array-item').forEach((item, index) => {
        const upBtn = item.querySelector('button:nth-of-type(1)')
        const downBtn = item.querySelector('button:nth-of-type(2)')

        if (upBtn) upBtn.disabled = index === 0
        if (downBtn) downBtn.disabled = index === formData.contacts.length - 1
      })
    }

    // 2. 工作经历管理
    window.addExperience = () => {
      const list = document.getElementById('experienceList')
      const index = formData.experiences.length

      if (index === 0) {
        list.innerHTML = ''
      }

      formData.experiences.push({
        company: '',
        position: '',
        startDate: '',
        endDate: '',
        current: false,
        description: ''
      })

      const item = document.createElement('div')
      item.className = 'array-item'
      item.innerHTML = `
        <div class="array-item-header">
          <span class="array-item-title">工作经历 #${index + 1}</span>
          <div class="array-item-actions">
            <button type="button" class="btn btn-remove" onclick="removeExperience(${index})">
              删除
            </button>
          </div>
        </div>
        <div class="array-item-fields">
          <div class="form-item">
            <label class="form-label"><span class="required">*</span>公司名称</label>
            <input type="text" class="form-input exp-company-${index}" placeholder="请输入公司名称" />
          </div>
          <div class="form-item">
            <label class="form-label"><span class="required">*</span>职位</label>
            <input type="text" class="form-input exp-position-${index}" placeholder="请输入职位" />
          </div>
          <div class="form-item">
            <label class="form-label">开始时间</label>
            <input type="date" class="form-input exp-startDate-${index}" />
          </div>
          <div class="form-item">
            <label class="form-label">结束时间</label>
            <input type="date" class="form-input exp-endDate-${index}" id="exp-endDate-${index}" />
            <label style="margin-top: 8px;">
              <input type="checkbox" class="exp-current-${index}" onchange="toggleCurrent(${index})"> 至今
            </label>
          </div>
        </div>
        <div class="form-item" style="margin-top: 12px;">
          <label class="form-label">工作描述</label>
          <textarea class="form-textarea exp-description-${index}" placeholder="描述工作内容和成就..." rows="3"></textarea>
        </div>
      `

      list.appendChild(item)
    }

    window.removeExperience = (index) => {
      formData.experiences.splice(index, 1)
      renderExperienceList()
    }

    window.toggleCurrent = (index) => {
      const checkbox = document.querySelector(`.exp-current-${index}`)
      const endDateInput = document.getElementById(`exp-endDate-${index}`)

      if (checkbox.checked) {
        endDateInput.disabled = true
        endDateInput.value = ''
      } else {
        endDateInput.disabled = false
      }
    }

    function renderExperienceList() {
      const list = document.getElementById('experienceList')

      if (formData.experiences.length === 0) {
        list.innerHTML = '<div class="empty-state">暂无工作经历</div>'
        return
      }

      list.innerHTML = ''
      formData.experiences.forEach((exp, index) => {
        const item = document.createElement('div')
        item.className = 'array-item'
        item.innerHTML = `
          <div class="array-item-header">
            <span class="array-item-title">工作经历 #${index + 1}</span>
            <div class="array-item-actions">
              <button type="button" class="btn btn-remove" onclick="removeExperience(${index})">
                删除
              </button>
            </div>
          </div>
          <div class="array-item-fields">
            <div class="form-item">
              <label class="form-label"><span class="required">*</span>公司名称</label>
              <input type="text" class="form-input exp-company-${index}" value="${exp.company}" placeholder="请输入公司名称" />
            </div>
            <div class="form-item">
              <label class="form-label"><span class="required">*</span>职位</label>
              <input type="text" class="form-input exp-position-${index}" value="${exp.position}" placeholder="请输入职位" />
            </div>
            <div class="form-item">
              <label class="form-label">开始时间</label>
              <input type="date" class="form-input exp-startDate-${index}" value="${exp.startDate}" />
            </div>
            <div class="form-item">
              <label class="form-label">结束时间</label>
              <input type="date" class="form-input exp-endDate-${index}" value="${exp.endDate}" id="exp-endDate-${index}" ${exp.current ? 'disabled' : ''} />
              <label style="margin-top: 8px;">
                <input type="checkbox" class="exp-current-${index}" ${exp.current ? 'checked' : ''} onchange="toggleCurrent(${index})"> 至今
              </label>
            </div>
          </div>
          <div class="form-item" style="margin-top: 12px;">
            <label class="form-label">工作描述</label>
            <textarea class="form-textarea exp-description-${index}" placeholder="描述工作内容和成就..." rows="3">${exp.description}</textarea>
          </div>
        `
        list.appendChild(item)
      })
    }

    // 3. 教育背景管理
    window.addEducation = () => {
      const list = document.getElementById('educationList')
      const index = formData.educations.length

      if (index === 0) {
        list.innerHTML = ''
      }

      formData.educations.push({
        school: '',
        major: '',
        degree: '',
        startDate: '',
        endDate: ''
      })

      const item = document.createElement('div')
      item.className = 'array-item'
      item.innerHTML = `
        <div class="array-item-header">
          <span class="array-item-title">教育背景 #${index + 1}</span>
          <div class="array-item-actions">
            <button type="button" class="btn btn-remove" onclick="removeEducation(${index})">
              删除
            </button>
          </div>
        </div>
        <div class="array-item-fields">
          <div class="form-item">
            <label class="form-label"><span class="required">*</span>学校名称</label>
            <input type="text" class="form-input edu-school-${index}" placeholder="请输入学校名称" />
          </div>
          <div class="form-item">
            <label class="form-label"><span class="required">*</span>专业</label>
            <input type="text" class="form-input edu-major-${index}" placeholder="请输入专业" />
          </div>
          <div class="form-item">
            <label class="form-label">学历</label>
            <select class="form-select edu-degree-${index}">
              <option value="">请选择</option>
              <option value="bachelor">本科</option>
              <option value="master">硕士</option>
              <option value="doctor">博士</option>
            </select>
          </div>
          <div class="form-item">
            <label class="form-label">入学时间</label>
            <input type="date" class="form-input edu-startDate-${index}" />
          </div>
          <div class="form-item">
            <label class="form-label">毕业时间</label>
            <input type="date" class="form-input edu-endDate-${index}" />
          </div>
        </div>
      `

      list.appendChild(item)
    }

    window.removeEducation = (index) => {
      formData.educations.splice(index, 1)
      renderEducationList()
    }

    function renderEducationList() {
      const list = document.getElementById('educationList')

      if (formData.educations.length === 0) {
        list.innerHTML = '<div class="empty-state">暂无教育背景</div>'
        return
      }

      list.innerHTML = ''
      formData.educations.forEach((edu, index) => {
        const item = document.createElement('div')
        item.className = 'array-item'
        item.innerHTML = `
          <div class="array-item-header">
            <span class="array-item-title">教育背景 #${index + 1}</span>
            <div class="array-item-actions">
              <button type="button" class="btn btn-remove" onclick="removeEducation(${index})">
                删除
              </button>
            </div>
          </div>
          <div class="array-item-fields">
            <div class="form-item">
              <label class="form-label"><span class="required">*</span>学校名称</label>
              <input type="text" class="form-input edu-school-${index}" value="${edu.school}" placeholder="请输入学校名称" />
            </div>
            <div class="form-item">
              <label class="form-label"><span class="required">*</span>专业</label>
              <input type="text" class="form-input edu-major-${index}" value="${edu.major}" placeholder="请输入专业" />
            </div>
            <div class="form-item">
              <label class="form-label">学历</label>
              <select class="form-select edu-degree-${index}">
                <option value="">请选择</option>
                <option value="bachelor" ${edu.degree === 'bachelor' ? 'selected' : ''}>本科</option>
                <option value="master" ${edu.degree === 'master' ? 'selected' : ''}>硕士</option>
                <option value="doctor" ${edu.degree === 'doctor' ? 'selected' : ''}>博士</option>
              </select>
            </div>
            <div class="form-item">
              <label class="form-label">入学时间</label>
              <input type="date" class="form-input edu-startDate-${index}" value="${edu.startDate}" />
            </div>
            <div class="form-item">
              <label class="form-label">毕业时间</label>
              <input type="date" class="form-input edu-endDate-${index}" value="${edu.endDate}" />
            </div>
          </div>
        `
        list.appendChild(item)
      })
    }

    // 提交表单
    document.getElementById('submitBtn').addEventListener('click', async () => {
      // 收集所有数据
      collectContactData()

      formData.experiences.forEach((exp, i) => {
        exp.company = document.querySelector(`.exp-company-${i}`)?.value || ''
        exp.position = document.querySelector(`.exp-position-${i}`)?.value || ''
        exp.startDate = document.querySelector(`.exp-startDate-${i}`)?.value || ''
        exp.endDate = document.querySelector(`.exp-endDate-${i}`)?.value || ''
        exp.current = document.querySelector(`.exp-current-${i}`)?.checked || false
        exp.description = document.querySelector(`.exp-description-${i}`)?.value || ''
      })

      formData.educations.forEach((edu, i) => {
        edu.school = document.querySelector(`.edu-school-${i}`)?.value || ''
        edu.major = document.querySelector(`.edu-major-${i}`)?.value || ''
        edu.degree = document.querySelector(`.edu-degree-${i}`)?.value || ''
        edu.startDate = document.querySelector(`.edu-startDate-${i}`)?.value || ''
        edu.endDate = document.querySelector(`.edu-endDate-${i}`)?.value || ''
      })

      await form.submit()
    })

    // 重置表单
    document.getElementById('resetBtn').addEventListener('click', () => {
      formData.contacts = []
      formData.experiences = []
      formData.educations = []

      renderContactList()
      renderExperienceList()
      renderEducationList()

      console.log('已重置所有数据')
    })

    // 显示成功消息
    function showSuccessMessage(message) {
      const msgDiv = document.createElement('div')
      msgDiv.className = 'success-message'
      msgDiv.textContent = message
      document.body.appendChild(msgDiv)

      setTimeout(() => {
        msgDiv.remove()
      }, 3000)
    }

    console.log('🔄 动态数组字段演示已加载')
  </script>
</body>

</html>


